<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cyber Detective</title>
  <link rel="icon" type="image/png" href="assets/img/icon.png">
  <link rel="stylesheet" href="assets/style.css">

</head>
<body>
  <!-- Floating Top Bar -->
  <div class="topbar">
    <div class="brand">
      <img src="assets/img/logo.png" alt="Logo">
      <span>Cyber Detective</span>
    </div>
    <div class="status">
      <span class="badge">⏱️ <span id="globalTimer">--:--</span></span>
      <span class="badge">🧩 Clues: <span id="clueProgress">0</span>/6</span>
      <span class="badge" id="unlockBadge">Next clue in: --</span>
    </div>
  </div>

  <img src="assets/img/logo.png" alt="Cyber Detective Logo" style="max-width:200px; margin:60px 0 20px;">

  <!-- Intro Page -->
  <div id="intro">
    <h1>🕵️‍♂️ Cyber Detective</h1>
    <p>You are part of a special cyber investigation unit. A serious digital breach has occurred in a company. Your mission is to analyze the clues, discuss with your team, and build a solid case against one of the potential suspects. Be careful — things are not always what they seem.</p>

    <h3>Suspects:</h3>
    <div class="suspects">
      <div class="suspect">
        <img src="assets/img/1.png" alt="Alex G.">
        <h4>Alex G.</h4>
        <p>A former IT technician recently let go after a heated argument with his manager.</p>
      </div>
      <div class="suspect">
        <img src="assets/img/2.png" alt="Jamie R.">
        <h4>Jamie R.</h4>
        <p>A young student known for bragging about hacking small websites just for fun.</p>
      </div>
      <div class="suspect">
        <img src="assets/img/3.png" alt="Sarah J.">
        <h4>Sarah J.</h4>
        <p>A respected marketing manager... but with unexplained meetings with a competitor.</p>
      </div>
      <div class="suspect">
        <img src="assets/img/hacker.png" alt="Unknown Hacker">
        <h4>Unknown (a.k.a. "The Shadow")</h4>
        <p>No records. No identity. Just traces left in the system...</p>
      </div>
    </div>

    <p>Each case contains 6 digital clues. You must read them carefully, take notes, and discuss with your group. Only one suspect is guilty in each case — but all may have motives. Good luck, detectives!</p>
    <button id="startBtn">Start Investigation</button>
  </div>

  <!-- Case Display -->
  <div id="case" class="hidden">
    <div class="clues-container" id="clueButtons"></div>
    <div class="helper" id="unlockHelper">Clues unlock automatically over time. Use your team’s notes wisely.</div>

    <button id="back-btn" onclick="goBack()">🔙 End Investigation</button>

    <hr style="margin-top: 40px; width: 100%; border-color: #00ffff30" />
    <div style="display: flex; flex-direction: column; align-items: center; gap: 20px; margin-top: 20px;">
      <h3>🕵️ Select the Suspect:</h3>
      <div style="display: flex; flex-direction: row; flex-wrap: wrap; justify-content: center; gap: 40px;">
        <div id="accusedVisual" class="hidden" style="text-align: center;"></div>
        <div>
          <select id="suspectSelect" style="padding: 8px; border-radius: 6px;" onchange="previewSuspect()">
            <option disabled selected>Choose a suspect</option>
            <option value="alex">Alex G.</option>
            <option value="jamie">Jamie R.</option>
            <option value="sarah">Sarah J.</option>
            <option value="hacker">Unknown (The Shadow)</option>
          </select>
          <button onclick="accuseSuspect()" style="margin-top: 10px;">Accuse</button>
        </div> 
      </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" style="display:none; position:fixed; bottom:0; left:0; width:100%; background:#1e1e1e; border-top: 2px solid #00ffff; z-index: 999;">
      <h3>Are you sure?</h3>
      <p>This action cannot be undone.</p>
      <button onclick="confirmAccusation()">✅ Confirm</button>
      <button onclick="cancelAccusation()">❌ Cancel</button>
    </div>
  </div>

  <!-- Clue / Debrief Modal -->
  <div id="modal" onclick="closeModal()">
    <div id="modal-content">
      <pre id="clueText">Clue content here...</pre>
    </div>
  </div>

  <script>
    /* =========================
       CONFIG
    ==========================*/
    const TIMER_MINUTES = 30;          // total time (minutes)
    const INITIAL_UNLOCK = 2;          // clues available at start
    const UNLOCK_COOLDOWN_SECONDS = 20; // seconds between automatic unlocks

    /* =========================
       CASES + DEBRIEFS
    ==========================*/
    const cases = [
      {
        title: "Case 1: The Disgruntled Insider",
        clues: [
          "🔐 Authentication Log (SIEM extract):\n02:43:12 — Successful VPN auth via legacy service account 'svc-ops-archive'.\nNotes: Account owner not defined. 19 prior failed attempts from user 'jamie.r' observed earlier (02:31–02:42).",
          "📁 File Access Audit:\n03:01:55 — Accessed //corp-share/HR/Offboarding/Policies_Archive.pdf from host 'WS-IT-04'.\nUser Context: SID maps to decommissioned IT workstation profile.",
          "🧾 Change Management Record:\nTicket CHG-2287 auto-closed at 03:14 with note 'restore job ran'. Approver field empty. Comment initials: 'AG'.",
          "💽 Device Control Log:\nHost 'WS-IT-04' mounted removable media 'USB-PHOTO-01' (read-only). Same host flagged as 'pending deallocation' last month.",
          "✉️ Mail Gateway (Draft Autosave):\n03:18 — Temp message buffer updated from 'it-outbox@'. Content fragment: 'treated / not listened / finally done'. Routing to Marketing mailbox 'sarah.j' failed.",
          "🚪 Badge vs VPN Correlation:\nNo physical entry recorded for 'Alex G.' past 24h, yet elevated access from IT subnet observed. TOR exit node sightings around the same window marked as 'UNKNOWN_ACTOR'."
        ],
        debrief: {
          keyPoints: [
            "Legacy service account used at odd hour (insider knowledge).",
            "Access to HR Offboarding folder from decommissioned IT host WS-IT-04.",
            "Change ticket auto-closed with initials 'AG' near the access time."
          ],
          misdirections: [
            "Earlier failed attempts by 'jamie.r' (looks noisy but unrelated).",
            "Mail fragment routed to 'sarah.j' (routing error, not intent)."
          ]
        }
      },
      {
        title: "Case 2: The Script Kiddie",
        clues: [
          "🛡️ IDS/Firewall Summary:\n01:58–02:56 — Credential stuffing on /auth with user rotation (guest, test, admin-old). User-Agent 'Mozilla/5.0'. Account 'alex.g' locked at 02:12.",
          "🖥️ Web App Log (Legacy Admin):\n02:56:03 — HTTP 200 at /admin-old/?panel=site using cookie 'PHPSESSID=...' from external IP. Referrer: none.",
          "🔗 VPN Session Detail:\n'LAPTOP-JR-02' connected via guest VPN at 02:58 for 4m12s. Viewed wiki: 'How_to_Reset_Admin_Theme'. Page 'BrandAssets' (owner: sarah.j) opened.",
          "🌐 Proxy & DNS Resolver:\nLookups: 'brutetool-lite.zip', 'panel_exploits.txt'. Category: Hacking Tools.",
          "🖼️ CDN Access Log:\n03:04 — Upload '/cdn/user/temporary/admin_dashboard.png' from guest VLAN. Retention: 24h.",
          "🧩 CMS Change Trace:\n03:06 — New temp file '/public/notice.tmp'. Text: 'your layers are tissue'. Correlated phrasing with prior 'UNKNOWN_ACTOR' notes."
        ],
        debrief: {
          keyPoints: [
            "Credential stuffing noise matches student patterns (generic UA).",
            "Guest VPN device 'LAPTOP-JR-02' browsing basic how‑to pages.",
            "Admin screenshot uploaded to temporary CDN (brag/souvenir)."
          ],
          misdirections: [
            "Account lock on 'alex.g' occurs during noise, not proof of insider.",
            "BrandAssets page owner 'sarah.j' is unrelated to access method."
          ]
        }
      },
      {
        title: "Case 3: The Competitor",
        clues: [
          "📨 Secure Mail Gateway:\n11:02 — Message to 'sarah.j' from 'ceo-office@fincorp.co' passed SPF/DKIM. Link to '/download?file=q4_report.zip'.",
          "📦 Share Storage Audit:\n11:07 — Download 'project_blueprints.zip' (842 MB) by user 'sarah.j' from '\\\\design-share\\R&D'. Permission grant to 'Marketing-Temp' just before.",
          "🖨️ Print Server Queue:\n11:12 — Job 'Blueprints_A3_Color' from 'MARKETING-LAPTOP-07'. Ticket REQ-4419 raised by 'alex.g' requested temp printer access prior day.",
          "🌐 DNS/Proxy Logs:\n11:20 — Outbound to 'cdn.novatech-resources.com/assets/img/' from 'MARKETING-LAPTOP-07'.",
          "🔒 MFA Timeline:\n11:03–11:06 — 5 MFA push approvals for 'sarah.j' from same device. Tight cluster suggests phish + fatigue.",
          "📅 Calendar Audit:\n'Lunch — external' by 'sarah.j' Tue/Thu (guest masked). Previous 'Website theme help — Jamie R.' last week."
        ],
        debrief: {
          keyPoints: [
            "Convincing look‑alike email triggers link and immediate large download.",
            "Temporary permissions + printer use right after download.",
            "MFA fatigue pattern aligns with phish timing."
          ],
          misdirections: [
            "Alex’s ticket about printers (operational, not access to R&D shares).",
            "Jamie’s calendar mention (website theme, unrelated to R&D data)."
          ]
        }
      },
      {
        title: "Case 4: The Shadow Hacker",
        clues: [
          "🕳️ SIEM Correlation:\n02:03 — Multiple auth attempts via TOR. Transient account 'temp-sync' created/disabled within 6 minutes by 'system'.",
          "🧪 EDR Telemetry (PowerShell):\n02:05 — Encoded command (1,024 chars) on 'APP-SRV-02' spawning 'rundll32'. Parent: 'w3wp.exe'.",
          "🌐 DNS Resolver:\n02:06 — Queries 'unknown-realm.biz' (registered <24h). TTL=60s.",
          "🗂️ File Integrity Monitor:\n02:07 — Created/deleted 'stage_tmp\\bundle.part03' under 'web-backup' service account.",
          "🖥️ Asset Inventory:\n02:08 — 'WS-IT-04' (A. Gomez; decommission pending) beaconed for 11s then silent.",
          "🗣️ Linguistic Fingerprint:\nPhrases in temp web files: 'doors / air / layers'. Similar to notes linked to other minor incidents (marketing edits; guest VLAN uploads)."
        ],
        debrief: {
          keyPoints: [
            "Use of TOR + temp account + web process parent indicates external actor.",
            "Fresh domain with low TTL and staging artifacts (bundle.part03).",
            "Touching a decommissioned host briefly to muddy attribution."
          ],
          misdirections: [
            "Phrasing overlaps with unrelated internal incidents (style collision).",
            "WS‑IT‑04 beacon could be a planted distraction referencing Alex."
          ]
        }
      }
    ];

    /* =========================
       STATE & ELEMENTS
    ==========================*/
    let currentCase = null;
    let selectedSuspect = null;
    let totalSeconds = 0;
    let timerId = null;
    let cooldown = 0;
    let unlockedCount = 0;

    const intro = document.getElementById("intro");
    const caseSection = document.getElementById("case");
    const modal = document.getElementById("modal");
    const clueText = document.getElementById("clueText");
    const clueButtons = document.getElementById("clueButtons");
    const globalTimer = document.getElementById("globalTimer");
    const clueProgress = document.getElementById("clueProgress");
    const unlockBadge  = document.getElementById("unlockBadge");

    // Ground truth mapping
    const correctSuspect = {
      "Case 1: The Disgruntled Insider": "alex",
      "Case 2: The Script Kiddie": "jamie",
      "Case 3: The Competitor": "sarah",
      "Case 4: The Shadow Hacker": "hacker"
    };

    document.getElementById("startBtn").addEventListener("click", startGame);

    function startGame() {
      // pick case
      const randomIndex = Math.floor(Math.random() * cases.length);
      currentCase = cases[randomIndex];

      // UI swap
      intro.classList.add("hidden");
      caseSection.classList.remove("hidden");

      // reset state
      selectedSuspect = null;
      document.getElementById("suspectSelect").selectedIndex = 0;
      document.getElementById("accusedVisual").classList.add("hidden");

      // build clue buttons (all locked initially)
      clueButtons.innerHTML = "";
      for (let i=0;i<currentCase.clues.length;i++){
        const btn = document.createElement("div");
        btn.className = "clue-box locked";
        btn.textContent = `🔍 Clue ${i + 1}`;
        btn.dataset.index = i;
        btn.onclick = () => {
          if (!btn.classList.contains("locked")) showClue(i);
        };
        clueButtons.appendChild(btn);
      }

      // unlock initial
      unlockedCount = 0;
      for(let i=0;i<INITIAL_UNLOCK;i++){ unlockNextClue(); }
      clueProgress.textContent = unlockedCount.toString();

      // timer setup
      totalSeconds = TIMER_MINUTES * 60;
      cooldown = UNLOCK_COOLDOWN_SECONDS;
      updateTopbar();
      if (timerId) clearInterval(timerId);
      timerId = setInterval(tick, 1000);
    }

    function tick(){
      // main timer
      totalSeconds--;
      if (totalSeconds <= 0){
        clearInterval(timerId);
        timerId = null;
        // time over
        clueText.innerHTML = "⏰ Time is up! Logs rotated and evidence lost.\n❌ The intruder remains unidentified.";
        modal.style.display = "flex";
        lockAllClues();
        return;
      }

      // progressive unlock
      if (unlockedCount < 6){
        cooldown--;
        if (cooldown <= 0){
          unlockNextClue();
          cooldown = UNLOCK_COOLDOWN_SECONDS;
        }
      } else {
        // all unlocked
        cooldown = 0;
      }

      updateTopbar();
    }

    function updateTopbar(){
      globalTimer.textContent = formatMMSS(totalSeconds);
      clueProgress.textContent = unlockedCount.toString();
      unlockBadge.textContent = (unlockedCount < 6)
        ? `Next clue in: ${formatMMSS(cooldown)}`
        : "All clues unlocked";
    }

    function unlockNextClue(){
      const boxes = Array.from(document.querySelectorAll(".clue-box"));
      const locked = boxes.find(b => b.classList.contains("locked"));
      if (!locked) return;
      locked.classList.remove("locked");
      locked.classList.add("unlocked");
      unlockedCount++;
    }

    function lockAllClues(){
      document.querySelectorAll(".clue-box").forEach(b=>{
        b.classList.add("locked");
        b.classList.remove("unlocked");
      });
    }

    function showClue(index) {
      clueText.textContent = currentCase.clues[index];
      modal.style.display = "flex";
    }
    function closeModal() { modal.style.display = "none"; }

    function goBack() {
      // clear timers
      if (timerId){ clearInterval(timerId); timerId = null; }
      currentCase = null;
      caseSection.classList.add("hidden");
      intro.classList.remove("hidden");
      // reset topbar badges
      globalTimer.textContent = "--:--";
      clueProgress.textContent = "0";
      unlockBadge.textContent = "Next clue in: --";
    }

    function accuseSuspect() {
      const select = document.getElementById("suspectSelect");
      const value = select.value;
      if (!value) return;
      selectedSuspect = value;
      document.getElementById("confirmModal").style.display = "block";
    }
    function cancelAccusation() {
      selectedSuspect = null;
      document.getElementById("suspectSelect").selectedIndex = 0;
      document.getElementById("accusedVisual").classList.add("hidden");
      document.getElementById("confirmModal").style.display = "none";
    }

    function confirmAccusation() {
      document.getElementById("confirmModal").style.display = "none";
      const isCorrect = selectedSuspect === correctSuspect[currentCase.title];

      // stop timer on decision
      if (timerId){ clearInterval(timerId); timerId = null; }

      if (isCorrect){
        // build debrief
        const d = currentCase.debrief;
        const key = d?.keyPoints || [];
        const mis = d?.misdirections || [];
        const solvedArt = `<img src='assets/img/case_solved.png' alt='Case Solved' style='max-width:120px; border: 1px solid var(--cyber); display:block; margin:0 auto 16px; border-radius:50%;'/>`;
        const lines = [
          "✅ Case closed. Well done, detective!",
          "",
          "— Key Evidence —",
          ...key.map((k,i)=>`${i+1}. ${k}`),
          "",
          "— Misdirections —",
          ...mis.map((m,i)=>`${i+1}. ${m}`)
        ].join("\n");
        clueText.innerHTML = solvedArt + lines.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");
      } else {
        const failArt = `<img src='assets/img/suspect_escape.png' alt='Suspect Escapes' style='max-width:120px; border: 1px solid #ff0000; display:block; margin:0 auto 16px; border-radius:50%;'/>`;
        clueText.innerHTML = failArt + "❌ The suspect escapes... The real intruder is still out there.";
      }
      modal.style.display = "flex";
    }

    function renderAccusedCard(suspectKey) {
      const container = document.getElementById("accusedVisual");
      const suspectsData = {
        alex:   { name: "Alex G.", img: "1.png",      desc: "A former IT technician recently let go after a heated argument." },
        jamie:  { name: "Jamie R.", img: "2.png",     desc: "A young student known for hacking small websites just for fun." },
        sarah:  { name: "Sarah J.", img: "3.png",     desc: "A respected marketing manager... with unexplained meetings." },
        hacker: { name: "Unknown (The Shadow)", img: "hacker.png", desc: "No records. No identity. Just traces left in the system..." }
      };
      const s = suspectsData[suspectKey];
      if (!s) return;
      container.innerHTML = `
        <div class="suspect" style="margin: 0 auto;">
          <img src="assets/img/${s.img}" alt="${s.name}">
          <h4>${s.name}</h4>
          <p>${s.desc}</p>
        </div>
      `;
      container.classList.remove("hidden");
    }
    function previewSuspect() {
      const select = document.getElementById("suspectSelect");
      const value = select.value;
      if (!value) return;
      renderAccusedCard(value);
    }

    function formatMMSS(total){
      const m = Math.floor(total/60);
      const s = total%60;
      return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    }
  </script>
</body>
</html>
